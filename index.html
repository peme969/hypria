<!--
  hypria — Copyright (C) 2025 peme969
  Licensed under the Hypria Non-Commercial Public Use License (HNCPUL) 1.0

  You may use, modify, and distribute this software only for non-commercial purposes,
  and any modified versions must be publicly distributed with source code.

  NO WARRANTY. See LICENSE for details.
-->
<!doctype html>
<html lang="en" style="overflow: hidden">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>hypria</title>
        <link rel="stylesheet" href="style.css" />
        <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Mozilla+Headline:wght@200..700&display=swap"
            rel="stylesheet"
        />
    </head>

    <body style="overflow: hidden">
        <video id="bg-video" autoplay muted loop playsinline>
            >
            <source
                src="https://cdn.donmai.us/original/f4/81/__original_drawn_by_gutty_kreum__f48116d976a2a52132d3c5ab6b759640.mp4"
                type="video/mp4"
            />
            Your browser does not support the video tag.
        </video>
        <!-- haha i like custom tags-->
        <box class="draggable boxes">
            <div class="row space">
                <div>
                    <div class="title" id="place">Loading…</div>
                    <div class="subtitle" id="subtitle">—</div>
                </div>
                <div class="tiny subtitle">
                    Powered by
                    <a
                        href="https://www.weatherapi.com/"
                        target="_blank"
                        rel="noreferrer"
                        >WeatherAPI</a
                    >
                    ·
                    <a
                        href="https://wttr.in/:help"
                        target="_blank"
                        rel="noreferrer"
                        >wttr.in</a
                    >
                </div>
            </div>
            <div class="current">
                <div class="tempRow">
                    <img id="condIcon" class="condIcon" alt="condition icon" />
                    <div class="temp" id="temp">--°</div>
                    <div class="unit-pill" id="unitToggle" aria-label="Units">
                        <button data-unit="F" class="active">F</button>
                        <button data-unit="C">C</button>
                    </div>
                </div>
                <div class="hiLo">
                    <span>High <span id="hi">--</span>°</span
                    ><span class="dot">•</span>
                    <span>Low <span id="lo">--</span>°</span>
                </div>
                <div class="subtitle condLine" id="cond">—</div>
                <div class="chipsRow">
                    <div class="chipTile">
                        <img
                            src="https://img.icons8.com/fluency/48/sunrise.png"
                            alt=""
                        /><span id="sunrise">--:--</span>
                    </div>
                    <div class="chipTile">
                        <img
                            src="https://img.icons8.com/fluency/48/sunset.png"
                            alt=""
                        /><span id="sunset">--:--</span>
                    </div>
                    <div class="chipTile" id="aqiChip" title="">
                        <span id="aqiShort">AQI —</span>
                    </div>
                </div>
                <div class="micro tiny" id="microStats">
                    Humidity —% • Precip —% • —
                </div>
            </div>

            <!-- ALERTS -->
            <div class="alert" id="alert" hidden>
                <div class="alertTop">
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        aria-hidden="true"
                    >
                        <circle
                            cx="12"
                            cy="12"
                            r="10"
                            stroke="var(--red)"
                            stroke-width="2"
                        />
                        <rect
                            x="11"
                            y="10"
                            width="2"
                            height="7"
                            fill="var(--red)"
                        />
                        <rect
                            x="11"
                            y="6.5"
                            width="2"
                            height="2"
                            fill="var(--red)"
                        />
                    </svg>
                    <span>Extreme weather advisory</span>
                    <span class="sep"></span>
                    <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        aria-hidden="true"
                    >
                        <circle
                            cx="12"
                            cy="12"
                            r="9"
                            stroke="var(--red)"
                            stroke-width="2"
                        />
                        <path
                            d="M12 7v5l3 2"
                            stroke="var(--red)"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        />
                    </svg>
                    <span id="alertAgo">—</span>
                    <span class="sep"></span>
                    <span id="alertWhen" style="color: #ff9b9c"></span>
                </div>
                <div class="alertSub">
                    <b id="alertEvent">—</b> <span class="dot">•</span>
                    <span id="alertSender">—</span>
                </div>
                <div class="alertDesc clamp2" id="alertDesc"></div>
            </div>
            <div class="forecast" id="forecast"></div>
        </box>
        <button class="bottom-button" onclick="switchWall()">
            <span></span>
        </button>

        <script>
            window.addEventListener("load", () => {
                const url =
                    document.getElementById("bg-video").currentSrc ||
                    document.getElementById("bg-video").src;
                if (url) applyTheme(mapTheme(url));
            });
            // these have comments because of the tutorial of the OG interactJS library docs!
            interact(".draggable").draggable({
                // enable inertial throwing
                inertia: true,
                // keep the element within the area of it's parent
                modifiers: [
                    interact.modifiers.restrictRect({
                        restriction: "parent",
                        endOnly: true,
                    }),
                ],
                // enable autoScroll
                autoScroll: true,

                listeners: {
                    // call this function on every dragmove event
                    move: dragMoveListener,

                    // call this function on every dragend event
                    end(event) {
                        var textEl = event.target.querySelector("p");

                        textEl &&
                            (textEl.textContent =
                                "moved a distance of " +
                                Math.sqrt(
                                    (Math.pow(event.pageX - event.x0, 2) +
                                        Math.pow(event.pageY - event.y0, 2)) |
                                        0,
                                ).toFixed(2) +
                                "px");
                    },
                },
            });

            function dragMoveListener(event) {
                var target = event.target;
                // keep the dragged position in the data-x/data-y attributes
                var x =
                    (parseFloat(target.getAttribute("data-x")) || 0) + event.dx;
                var y =
                    (parseFloat(target.getAttribute("data-y")) || 0) + event.dy;

                // translate the element
                target.style.transform = "translate(" + x + "px, " + y + "px)";

                // update the posiion attributes
                target.setAttribute("data-x", x);
                target.setAttribute("data-y", y);
            }

            // this function is used later in the resizing and gesture demos
            window.dragMoveListener = dragMoveListener;
            const PALETTES = {
                forest: { t1: [88, 170, 136], t2: [40, 78, 66], glass: 0.3 },
                meadow: { t1: [106, 168, 255], t2: [64, 99, 191], glass: 0.26 },
                nebula: { t1: [170, 94, 255], t2: [69, 44, 120], glass: 0.28 },
                blackhole: {
                    t1: [255, 124, 96],
                    t2: [63, 21, 21],
                    glass: 0.32,
                },
                windows: { t1: [92, 161, 255], t2: [26, 70, 140], glass: 0.24 },
                earth: { t1: [88, 139, 247], t2: [32, 46, 88], glass: 0.28 },
                desert: { t1: [227, 165, 76], t2: [84, 55, 26], glass: 0.3 },
                default: {
                    t1: [132, 148, 230],
                    t2: [58, 69, 112],
                    glass: 0.28,
                },
            };
            function mapTheme(url) {
                const u = url.toLowerCase();
                if (u.includes("forest") || u.includes("river"))
                    return PALETTES.forest;
                if (u.includes("ghibli") || u.includes("landscape"))
                    return PALETTES.meadow;
                if (u.includes("nebula") || u.includes("singularity"))
                    return PALETTES.nebula;
                if (u.includes("black") && u.includes("hole"))
                    return PALETTES.blackhole;
                if (u.includes("windows") || u.includes("logo"))
                    return PALETTES.windows;
                if (u.includes("earth") || u.includes("orbit"))
                    return PALETTES.earth;
                if (u.includes("desert")) return PALETTES.desert;
                return PALETTES.default;
            }
            function applyTheme(p) {
                const r = document.documentElement.style;
                r.setProperty("--tint-1", `${p.t1[0]} ${p.t1[1]} ${p.t1[2]}`);
                r.setProperty("--tint-2", `${p.t2[0]} ${p.t2[1]} ${p.t2[2]}`);
                r.setProperty("--glass-a", String(p.glass ?? 0.28));
            }
            var walls = [
                "https://cdn.donmai.us/original/be/d0/__original_drawn_by_hisachan55cute__bed01509fe09fdaabe37b5df707fcacc.mp4",
                "https://cdn.donmai.us/original/c3/43/__original_drawn_by_hisachan55cute__c3435fc2481d6434c8b24415fd12e87b.mp4",
                "https://cdn.donmai.us/original/ac/32/__original_drawn_by_zandra__ac3242dfa7c86d1af47f409d7acabb3b.mp4",
                "https://www.desktophut.com/files/dbJ0KsEKmfwEfQN_Boat_1_221932.mp4",
                "https://desktophut.com/files/Forest%20River%20HD%20Live%20Wallpaper.mp4",
                "https://desktophut.com/files/Windows%2011%203D%20Logo%20Live%20Wallpaper.mp4",
                "https://www.desktophut.com/files/1683984004-1683984004-animated-wallpapers-on-linux.mp4",
                "https://desktophut.com/files/Windows%2011%20Live%20Wallpaper.mp4",
                "https://www.desktophut.com/files/gAubL4NW9x6QyFu_Singularity%20View(1).mp4",
                "https://www.desktophut.com/files/1674107243-1674107243-windows-10.mp4",
                "https://www.desktophut.com/files/1655315303-1655315303-windows-10-neon-hd-live-wallpaper-for-pc.mp4",
                "https://www.desktophut.com/files/1655315310-1655315310-windows-10-hd-live-wallpaper-for-pc.mp4",
                "https://www.desktophut.com/files/Live%20Wallpaper%20Windows%2010%20Nature%20Live%20Wallpaper%20.mp4",
                "https://www.desktophut.com/files/Windows%2010%20Win%20Live%20Wallpaper4.m4v",
                "https://www.desktophut.com/files/RNoevT8mKsCD0Bd_ope_2_prob4.mp4",
                "https://www.desktophut.com/files/cijnBXRqv3oofwt_Black%20Hole%204K%20Live%20Wallpaper.mp4",
                "https://desktophut.com/files/4k%20Galaxy%20Nebula%20Animation%20Live%20Wallpaper.mp4",
                "https://www.desktophut.com/files/AXPXstqkPQgJT07_Astronaut%20And%20Black%20Hole%20Live%20Wallpaper.mp4",
                "https://www.desktophut.com/files/jPP9bjwaZA3d12F_Studio%20Ghibli%20Landscape%202%20Prob4.mp4",
                "https://www.desktophut.com/files/tJN1AdW2JgmexOJ_Solar%20System_2_prob4.mp4",
                "https://www.desktophut.com/files/iZkm2FhNmQnHiGu_Dream%20View%20Live%20Wallpaper.mp4",
                "https://www.desktophut.com/files/ftCe0V56t9qkKLn_Moonlithght%20Lake%20Serene%20Landscape_2_prob4.mp4",
                "https://www.desktophut.com/files/D3KB82St1TtjtDC_3D%20Earth%20-%20Close%20Orbit%20Live%20Wallpaper.mp4",
                "https://www.desktophut.com/files/1668457926-1668457926-blue-earth-live-wallpaper.mp4",
                "https://www.desktophut.com/files/8AmAVgZyuafo0Z7_Relaxing%20Landscape%20Live%20Wallpaper_3_203944.mp4",
                "https://cdn.donmai.us/original/f4/81/__original_drawn_by_gutty_kreum__f48116d976a2a52132d3c5ab6b759640.mp4",
            ];
            function switchWall() {
                let index = Math.floor(Math.random() * walls.length);
                document.getElementById("bg-video").src = walls[index];
                document.getElementById("bg-video").load();
                applyTheme(mapTheme(walls[index]));
            }
        </script>
        <script>
            (async () => {
                const RAW_Q = prompt(
                    "Enter your location (city, long/lat, state",
                );
                const Q = encodeURIComponent(RAW_Q);
                const state = { unit: "F", data: null };
                const WIND_ICON_BASE = "./";
                function getWindIcon(speed, isF) {
                    const mph = isF ? Number(speed) : Number(speed) / 1.60934;
                    if (mph < 3) return "/assets/icons8-wind-speed-1-2-50.png";
                    if (mph < 8) return "/assets/icons8-wind-speed-3-7-50.png";
                    if (mph < 13)
                        return "/assets/icons8-wind-speed-8-12-50.png";
                    if (mph < 18)
                        return "/assets/icons8-wind-speed-13-17-50.png";
                    return "/assets/icons8-wind-speed-18-22-50.png";
                }
                function aqiInfo(idx) {
                    const label =
                        {
                            1: "Good",
                            2: "Moderate",
                            3: "Unhealthy for Sensitive Groups",
                            4: "Unhealthy",
                            5: "Very Unhealthy",
                            6: "Hazardous",
                        }[Number(idx)] || "—";
                    const desc =
                        {
                            1: "Air quality is satisfactory; little or no risk.",
                            2: "Acceptable; a few unusually sensitive people may be affected.",
                            3: "Sensitive groups may experience effects; general public less likely.",
                            4: "Everyone may begin to feel effects; sensitive groups more serious.",
                            5: "Health warnings of emergency conditions possible.",
                            6: "Health alert: serious health effects for everyone.",
                        }[Number(idx)] || "";
                    return { label, desc };
                }
                function timeAgo(iso) {
                    if (!iso) return "—";
                    const t = Date.parse(iso);
                    if (Number.isNaN(t)) return "—";
                    const diff = Math.max(0, Date.now() - t);
                    const sec = Math.floor(diff / 1000),
                        min = Math.floor(sec / 60),
                        hr = Math.floor(min / 60),
                        day = Math.floor(hr / 24);
                    if (day >= 1) return `${day} day${day > 1 ? "s" : ""} ago`;
                    if (hr >= 1) return `${hr} hour${hr > 1 ? "s" : ""} ago`;
                    if (min >= 1)
                        return `${min} minute${min > 1 ? "s" : ""} ago`;
                    return `${sec} sec ago`;
                }
                const fmtTime = (s) => {
                    const t = Date.parse(s);
                    return Number.isNaN(t)
                        ? "—"
                        : new Date(t).toLocaleString([], {
                              weekday: "short",
                              month: "short",
                              day: "numeric",
                              hour: "2-digit",
                              minute: "2-digit",
                          });
                };
                const dayName = (d) =>
                    new Date(d).toLocaleDateString([], { weekday: "short" });
                async function load() {
                    const res = await fetch(
                        `https://api.peme969.dev/weather?q=${Q}`,
                    );
                    if (!res.ok) throw new Error(`WeatherAPI ${res.status}`);
                    state.data = await res.json();
                    try {
                        const wt = await fetch(
                            `https://wttr.in/${RAW_Q}?format=j1`,
                            {
                                mode: "cors",
                            },
                        );
                        if (wt.ok) {
                            const j = await wt.json();
                            const a = j?.weather?.[0]?.astronomy?.[0] || {};
                            setTxt("sunrise", a.sunrise);
                            setTxt("sunset", a.sunset);
                        }
                    } catch (_) {}
                    render();
                }
                function setTxt(id, v) {
                    document.getElementById(id).textContent = v || "--:--";
                }
                function render() {
                    const d = state.data,
                        isF = state.unit === "F";
                    document.getElementById("place").textContent =
                        `${d.location.name}, ${d.location.region || d.location.country}`;
                    document.getElementById("subtitle").textContent =
                        `${d.current.condition.text} • ${fmtTime(d.location.localtime)}`;
                    const cur = d.current,
                        today = d.forecast.forecastday[0].day;
                    document.getElementById("cond").textContent =
                        cur.condition.text || "";
                    document.getElementById("condIcon").src =
                        `https:${cur.condition.icon ?? ""}`;
                    document.getElementById("temp").textContent =
                        `${Math.round(isF ? cur.temp_f : cur.temp_c)}°`;

                    setTxt(
                        "hi",
                        Math.round(isF ? today.maxtemp_f : today.maxtemp_c),
                    );
                    setTxt(
                        "lo",
                        Math.round(isF ? today.mintemp_f : today.mintemp_c),
                    );
                    const aqiIdx = cur.air_quality?.["us-epa-index"];
                    const { label, desc } = aqiInfo(aqiIdx);
                    document.getElementById("aqiShort").textContent =
                        `AQI ${aqiIdx ?? "—"} ${label}`;
                    document.getElementById("aqiChip").title = desc;
                    const hum = `${cur.humidity ?? "—"}%`;
                    const pr = `${today.daily_chance_of_rain ?? 0}%`;
                    const windSpeed = isF ? cur.wind_mph : cur.wind_kph;
                    const windUnit = isF ? "mph" : "kph";
                    const windIcon =
                        WIND_ICON_BASE + getWindIcon(windSpeed ?? 0, isF);
                    document.getElementById("microStats").innerHTML =
                        `Humidity ${hum} • Precip ${pr} • ` +
                        `<img class="wind-ico" src="${windIcon}" alt="wind"> ` +
                        `${(windSpeed ?? 0).toFixed(1)} ${windUnit} ${cur.wind_dir ?? ""}`;
                    const alerts = d.alerts?.alert ?? [];
                    const bar = document.getElementById("alert");
                    if (alerts.length) {
                        const a = alerts[0];
                        const stamp =
                            a.effective ||
                            a.expires ||
                            d.location.localtime ||
                            "";
                        setTxt("alertEvent", a.event || "Weather alert");
                        setTxt("alertSender", a.sender_name || a.areas || "");
                        setTxt("alertDesc", a.desc || a.headline || "");
                        setTxt("alertWhen", fmtTime(stamp));
                        setTxt("alertAgo", timeAgo(stamp));
                        bar.hidden = false;
                    } else {
                        bar.hidden = true;
                    }
                    const wrap = document.getElementById("forecast");
                    wrap.innerHTML = d.forecast.forecastday
                        .map((fd) => {
                            const hi = Math.round(
                                isF ? fd.day.maxtemp_f : fd.day.maxtemp_c,
                            );
                            const lo = Math.round(
                                isF ? fd.day.mintemp_f : fd.day.mintemp_c,
                            );
                            const windMax = Math.round(
                                isF ? fd.day.maxwind_mph : fd.day.maxwind_kph,
                            );
                            const windUnit = isF ? "mph" : "kph";
                            return `<div class="day">
              <img src="https:${fd.day.condition.icon}" width="40" height="40" alt="${fd.day.condition.text}">
              <div>
                <div class="name">${dayName(fd.date)}</div>
                <div class="subtitle" style="font-size:.85rem">${fd.day.condition.text}</div>
                <div>High ${hi}° • Low ${lo}°</div>
                <div class="subtitle" style="font-size:.8rem">Rain ${fd.day.daily_chance_of_rain ?? 0}% • Wind ${windMax} ${windUnit}</div>
              </div>
            </div>`;
                        })
                        .join("");
                }
                const toggle = document.getElementById("unitToggle");
                toggle.addEventListener("click", (e) => {
                    const btn = e.target.closest("button");
                    if (!btn) return;
                    const unit = btn.dataset.unit;
                    if (unit && unit !== state.unit) {
                        state.unit = unit;
                        [...toggle.querySelectorAll("button")].forEach((b) =>
                            b.classList.toggle(
                                "active",
                                b.dataset.unit === unit,
                            ),
                        );
                        if (state.data) render();
                    }
                });
                try {
                    await load();
                } catch (err) {
                    document.getElementById("card").innerHTML =
                        `<div style="display:flex;align-items:center;justify-content:center;height:100%">
            <div><div style="font-weight:700;margin-bottom:6px">Couldn’t load weather</div>
            <div style="color:#9aa3b2">${String(err.message || err)}</div></div></div>`;
                    console.error(err);
                }
            })();
        </script>
    </body>
</html>
